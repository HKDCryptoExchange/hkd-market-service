syntax = "proto3";

package hkd.auth.v1;

option java_package = "com.hkd.auth.grpc";
option java_multiple_files = true;
option go_package = "github.com/HKDCryptoExchange/hkd-order-gateway/pb/auth/v1";

// 认证服务 - JWT验证和权限检查
service AuthService {
  // 验证 JWT Token（API Gateway拦截器使用）
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);

  // 验证 TOTP（双因素认证）
  rpc ValidateTOTP(ValidateTOTPRequest) returns (ValidateTOTPResponse);

  // 检查用户权限
  rpc CheckPermission(CheckPermissionRequest) returns (CheckPermissionResponse);
}

// ==================== 验证Token ====================

message ValidateTokenRequest {
  string access_token = 1;
}

message ValidateTokenResponse {
  bool valid = 1;
  string user_id = 2;
  string username = 3;
  string email = 4;
  repeated string roles = 5;
  int64 expires_at = 6;  // Unix timestamp
}

// ==================== 验证TOTP ====================

message ValidateTOTPRequest {
  string user_id = 1;
  string totp_code = 2;
}

message ValidateTOTPResponse {
  bool valid = 1;
  string message = 2;
}

// ==================== 检查权限 ====================

message CheckPermissionRequest {
  string user_id = 1;
  string resource = 2;  // TRADE, WITHDRAW, ADMIN
  string action = 3;    // CREATE, READ, UPDATE, DELETE
}

message CheckPermissionResponse {
  bool allowed = 1;
  string message = 2;
}
